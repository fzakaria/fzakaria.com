<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HypeMachine Cocoa Woes | Farid Zakaria’s Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="HypeMachine Cocoa Woes" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Cocoa So I&#39;ve been working at trying to refit the Python batch downloader as a GUI application; specifically a mac application written in Cocoa. However, porting the existing code has been much more troublesome/difficult than I expected. Background Each song link in HypeMachine is built using 2 tags: the song&#39;s id and a key. With these two tags, the final url to stream the song is: &#39;http://hypem.com/serve/play/&#39; + id + &#39;/&#39; + key + &#39;.mp3&#39; As far as I can tell from what I&#39;ve determined (my javascript is pretty limited), is that the key&#39;s are generated on the server side based on a timestamp. So if you look at my python code, I perform the following steps: url=&#39;http://hypem.com/popular/1?ax=1&amp;ts=&#39;+str(time.time()) request = urllib2.Request(url) response = urllib2.urlopen(request) html = response.read() Running the above script multiple times appropriately generates different keys every time. The key and ID are parsed from the HTML, where they occur in the following format: trackList[document.location.href].push({ type:&#39;normal&#39;, id:&#39;1a08r&#39;, postid:&#39;1433616&#39;, posturl:&#39;http://jackinforlinks.com/wiz-khalifa-rooftops-ft-curreny/&#39;, time:&#39;261&#39;, ts: &#39;1300754012&#39;, fav:&#39;0&#39;, key: &#39;30b2310a6f3fb28564d443ffb3804ffc&#39;, imeem_id:&#39;&#39;, artist:&#39;Wiz Khalifa&#39;, song:&#39;Rooftops Ft. Currensy (Produced By E. ...&#39;, amazon:&#39;&#39;, itunes:&#39;&#39;, emusic:&#39;&#39;, exact_track_avail:&#39;0&#39; }); &lt;/p&gt; The problem I&#39;ve been running into multiple problems porting this over to Objective-C cocoa. However the most damaging is the fact that I cannot seem to generate the appropriate HTML file. The HTML file I keep generating has invalid keys. I am retrieving the HTML and parsing it similarly as I did in Python however the server is returning me invalid keys. Not only are the keys invalid, however re-running my application, retrieves the same keys over and over. This helps confirm that they are feeding me garbage keys as they are not being properly dynamically generated. I&#39;ve attempted to retrieve the keys in the following manner (both of which do not work): NSTimeInterval time = [[NSDate date] timeIntervalSince1970]; NSString * completeUrl = [url stringByAppendingFormat:@&quot;/%d?ax=1&amp;ts=%1.2f&quot;, pageNumber, time]; NSURL * hypeURL = [NSURL URLWithString:completeUrl];" />
<meta property="og:description" content="Cocoa So I&#39;ve been working at trying to refit the Python batch downloader as a GUI application; specifically a mac application written in Cocoa. However, porting the existing code has been much more troublesome/difficult than I expected. Background Each song link in HypeMachine is built using 2 tags: the song&#39;s id and a key. With these two tags, the final url to stream the song is: &#39;http://hypem.com/serve/play/&#39; + id + &#39;/&#39; + key + &#39;.mp3&#39; As far as I can tell from what I&#39;ve determined (my javascript is pretty limited), is that the key&#39;s are generated on the server side based on a timestamp. So if you look at my python code, I perform the following steps: url=&#39;http://hypem.com/popular/1?ax=1&amp;ts=&#39;+str(time.time()) request = urllib2.Request(url) response = urllib2.urlopen(request) html = response.read() Running the above script multiple times appropriately generates different keys every time. The key and ID are parsed from the HTML, where they occur in the following format: trackList[document.location.href].push({ type:&#39;normal&#39;, id:&#39;1a08r&#39;, postid:&#39;1433616&#39;, posturl:&#39;http://jackinforlinks.com/wiz-khalifa-rooftops-ft-curreny/&#39;, time:&#39;261&#39;, ts: &#39;1300754012&#39;, fav:&#39;0&#39;, key: &#39;30b2310a6f3fb28564d443ffb3804ffc&#39;, imeem_id:&#39;&#39;, artist:&#39;Wiz Khalifa&#39;, song:&#39;Rooftops Ft. Currensy (Produced By E. ...&#39;, amazon:&#39;&#39;, itunes:&#39;&#39;, emusic:&#39;&#39;, exact_track_avail:&#39;0&#39; }); &lt;/p&gt; The problem I&#39;ve been running into multiple problems porting this over to Objective-C cocoa. However the most damaging is the fact that I cannot seem to generate the appropriate HTML file. The HTML file I keep generating has invalid keys. I am retrieving the HTML and parsing it similarly as I did in Python however the server is returning me invalid keys. Not only are the keys invalid, however re-running my application, retrieves the same keys over and over. This helps confirm that they are feeding me garbage keys as they are not being properly dynamically generated. I&#39;ve attempted to retrieve the keys in the following manner (both of which do not work): NSTimeInterval time = [[NSDate date] timeIntervalSince1970]; NSString * completeUrl = [url stringByAppendingFormat:@&quot;/%d?ax=1&amp;ts=%1.2f&quot;, pageNumber, time]; NSURL * hypeURL = [NSURL URLWithString:completeUrl];" />
<link rel="canonical" href="https://fzakaria.com/old_blog/2011-03-23-hypemachine-cocoa-woes.html" />
<meta property="og:url" content="https://fzakaria.com/old_blog/2011-03-23-hypemachine-cocoa-woes.html" />
<meta property="og:site_name" content="Farid Zakaria’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-03-23T14:07:27-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HypeMachine Cocoa Woes" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-03-23T14:07:27-07:00","datePublished":"2011-03-23T14:07:27-07:00","description":"Cocoa So I&#39;ve been working at trying to refit the Python batch downloader as a GUI application; specifically a mac application written in Cocoa. However, porting the existing code has been much more troublesome/difficult than I expected. Background Each song link in HypeMachine is built using 2 tags: the song&#39;s id and a key. With these two tags, the final url to stream the song is: &#39;http://hypem.com/serve/play/&#39; + id + &#39;/&#39; + key + &#39;.mp3&#39; As far as I can tell from what I&#39;ve determined (my javascript is pretty limited), is that the key&#39;s are generated on the server side based on a timestamp. So if you look at my python code, I perform the following steps: url=&#39;http://hypem.com/popular/1?ax=1&amp;ts=&#39;+str(time.time()) request = urllib2.Request(url) response = urllib2.urlopen(request) html = response.read() Running the above script multiple times appropriately generates different keys every time. The key and ID are parsed from the HTML, where they occur in the following format: trackList[document.location.href].push({ type:&#39;normal&#39;, id:&#39;1a08r&#39;, postid:&#39;1433616&#39;, posturl:&#39;http://jackinforlinks.com/wiz-khalifa-rooftops-ft-curreny/&#39;, time:&#39;261&#39;, ts: &#39;1300754012&#39;, fav:&#39;0&#39;, key: &#39;30b2310a6f3fb28564d443ffb3804ffc&#39;, imeem_id:&#39;&#39;, artist:&#39;Wiz Khalifa&#39;, song:&#39;Rooftops Ft. Currensy (Produced By E. ...&#39;, amazon:&#39;&#39;, itunes:&#39;&#39;, emusic:&#39;&#39;, exact_track_avail:&#39;0&#39; }); &lt;/p&gt; The problem I&#39;ve been running into multiple problems porting this over to Objective-C cocoa. However the most damaging is the fact that I cannot seem to generate the appropriate HTML file. The HTML file I keep generating has invalid keys. I am retrieving the HTML and parsing it similarly as I did in Python however the server is returning me invalid keys. Not only are the keys invalid, however re-running my application, retrieves the same keys over and over. This helps confirm that they are feeding me garbage keys as they are not being properly dynamically generated. I&#39;ve attempted to retrieve the keys in the following manner (both of which do not work): NSTimeInterval time = [[NSDate date] timeIntervalSince1970]; NSString * completeUrl = [url stringByAppendingFormat:@&quot;/%d?ax=1&amp;ts=%1.2f&quot;, pageNumber, time]; NSURL * hypeURL = [NSURL URLWithString:completeUrl];","headline":"HypeMachine Cocoa Woes","mainEntityOfPage":{"@type":"WebPage","@id":"https://fzakaria.com/old_blog/2011-03-23-hypemachine-cocoa-woes.html"},"url":"https://fzakaria.com/old_blog/2011-03-23-hypemachine-cocoa-woes.html"}</script>
<!-- End Jekyll SEO tag -->

        <link type="application/atom+xml" rel="alternate" href="https://fzakaria.com/feed.xml" title="Farid Zakaria&apos;s Blog" />
        <link rel="stylesheet" type="text/css" href="/assets/css/base.css">
        <link rel="icon" type="image/x-icon" href="/assets/images/avatar.ico">
        <link rel="alternate" type="application/atom+xml" title="Farid Zakaria's Blog" href="/feed.xml">

        <link ref="">

        
        
        <link href="/assets/css/highlightjs-default-theme.css" rel="stylesheet" />
        

        
            <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-35360900-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-35360900-1');
</script>

        

    </head>
    <body>
        
        <script src="/assets/js/highlight.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        

        <div class="container">
            <h1 class="page-title">
    <a class="rss pull-right" href="/feed.xml"><i class="fa fa-rss"></i></a>
    HypeMachine Cocoa Woes
</h1>

<div class="content">
    
    <p class="date">
        Published 2011-03-23
        on <a href="/">Farid Zakaria's Blog</a>
        <span class="hidden-xs">
          &mdash;
          <a href="/old_blog/2011-03-23-hypemachine-cocoa-woes.html">
            Permalink
          </a>
        </span>
    </p>
    
    <article>
      <h2> Cocoa </h2>
<p>
So I've been working at trying to refit the <a href="http://www.blog.fzakaria.com/2011/02/hypemachine-batch-downloader-2-0/">Python batch downloader</a> as a GUI application; specifically a mac application written in Cocoa. However, porting the existing code has been much more troublesome/difficult than I expected.</p>
<h3> Background </h3>
<p>
Each song link in HypeMachine is built using 2 tags: the song's id and a key. With these two tags, the final url to stream the song is: </p>
<blockquote><p>'http://hypem.com/serve/play/' + id + '/' + key + '.mp3'</p></blockquote>
<p>As far as I can tell from what I've determined (my javascript is pretty limited), is that the key's are generated on the server side based on a timestamp. So if you look at my python code, I perform the following steps:</p>
<pre>
<code>
url='http://hypem.com/popular/1?ax=1&ts='+str(time.time())
request = urllib2.Request(url)
response = urllib2.urlopen(request)
html = response.read()
</code>
</pre>
<p>Running the above script multiple times <strong>appropriately</strong> generates different <em>keys</em> every time.</p>
<p>The key and ID are parsed from the HTML, where they occur in the following format:</p>
<pre>
<code>
trackList[document.location.href].push({	
	type:'normal',
	id:'1a08r',
	postid:'1433616',
	posturl:'http://jackinforlinks.com/wiz-khalifa-rooftops-ft-curreny/',
	time:'261',
	ts: '1300754012',
	fav:'0',
	key: '30b2310a6f3fb28564d443ffb3804ffc',
	imeem_id:'',
	artist:'Wiz Khalifa',
	song:'Rooftops Ft. Currensy (Produced By E. ...',
	amazon:'',
	itunes:'',
	emusic:'',
	exact_track_avail:'0'
  });
</code>
</pre></p>
<h3> The problem </h3>
<p>
I've been running into multiple problems porting this over to Objective-C cocoa. However the most damaging is the fact that I cannot seem to generate the appropriate HTML file. The HTML file I keep generating has <strong>invalid</strong> keys.</p>
<blockquote><p> I am retrieving the HTML and parsing it similarly as I did in Python however the server is returning me invalid keys.</p></blockquote>
<p>Not only are the keys invalid, however re-running my application, retrieves the same keys over and over. This helps confirm that they are feeding me garbage keys as they are not being properly dynamically generated. I've attempted to retrieve the keys in the following manner (both of which do not work):</p>
<pre>
<code>
NSTimeInterval time = [[NSDate date] timeIntervalSince1970];
NSString * completeUrl = [url stringByAppendingFormat:@"/%d?ax=1&ts=%1.2f", pageNumber, time];
NSURL * hypeURL = [NSURL URLWithString:completeUrl];

//ATTEMPT 1
NSString * hypeHTML = [NSString stringWithContentsOfURL:hypeURL encoding:NSASCIIStringEncoding error:nil];

//ATEMPT 2
NSString* userAgent = @"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8) Gecko/20051111 Firefox/1.5 BAVM/1.0.0";
NSMutableURLRequest* request = [[[NSMutableURLRequest alloc] initWithURL:hypeURL] autorelease];
[request setValue:userAgent forHTTPHeaderField:@"User-Agent"];
NSURLResponse* response = nil;
NSError* error = nil;
NSData* data = [NSURLConnection sendSynchronousRequest:request returningResponse:&response error:&error];
NSString *hypeHTML = [[NSString alloc] initWithData:data encoding:NSASCIIStringEncoding];
</code>
</pre></p>
<h3> Request </h3>
<p>
If anyone has some ideas on how they can help me fix my problem please let me know via a comment, e-mail or my question at <a href="http://stackoverflow.com/questions/5371709/making-http-requests-in-cocoa-mimic-browser">Stackoverflow</a>. I'm also looking for help on setting up the GUI / Core data model for the application once I get this issue sorted out if you'd like to help in that respect as well.</p>


<hr />
    </article>
</div>

<div class="sidebar">
    <hr class="visible-xs" />
    <img class="avatar" src="/assets/images/avatar-164.png" alt="A photo of my dog Moose" title="My dog Moose"/>
    <p>I'm a software engineer, father and wishful amateur surfer. If you've come seeking my political views; you've found the wrong <a href="https://fareedzakaria.com/">Fareed</a>.</p>
    <div class="external-links">
      <p>
        <span class="context">linkedin</span>
        <a href="https://www.linkedin.com/in/fmzakari/">fmzakari</a>
      </p>
      <p>
        <span class="context">github</span>
        <a href="https://github.com/fzakaria">fzakaria</a>
      </p>
      <p>
        <span class="context">email</span>
        <a href="mailto:farid.m.zakaria@gmail.com">farid.m.zakaria@gmail.com</a>
      </p>
      <p>
        <span class="context">pgp</span>
        <a href="/publickey.txt">D1B232E7</a>
      </p>
      <p>
        <a href="/archive">Archive</a>
      </p>
      <p>
        <a href="/old_blog/">Historic WordPress Blog</a>
      </p>
      <!--
      <p>
        Web friendly version of my <a href="/resume/index.html">resume</a>.
      </p>
    </div>
    <h3>Projects</h3>
    <p>
      <a href="/projects/">Click here</a> for some personal
      projects I've worked on.
    </p>
    <h3>Old Blog</h3>
    <p>
      <a href="/old_blog/">Click here</a> for the archive
      of my old blog posts from Wordpress.
    </p>
    -->
    
    <h3>Recent Posts</h3>
    
    <div class="post-stub">
      2025-02-02<br />
      <a href="/2025/02/02/nix-string-interpolation-of-directories-gone-awry.html">Nix: string interpolation of directories gone awry</a>
    </div>
    
    <div class="post-stub">
      2025-01-28<br />
      <a href="/2025/01/28/bazel-build-event-protocol-viewer.html">Bazel: Build Event Protocol Viewer</a>
    </div>
    
    <div class="post-stub">
      2025-01-12<br />
      <a href="/2025/01/12/bazel-knowledge-be-mindful-of-build-without-the-bytes.html">Bazel Knowledge: Be mindful of Build Without the Bytes (bwob)</a>
    </div>
    
    
    <h3>License</h3>
    <p style="font-size: 10pt">
    The content for this site is
    <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
    The <a href="https://github.com/SirCmpwn/ddjekyll">inspiration for the theme</a> for this site is
    © Drew Devault.
    </p>
    <div class="spacer" style="margin-top: 30px;"></div>
    
    <p><a href="https://github.com/fzakaria/fzakaria.com/edit/master/_old_blog/2011-03-23-hypemachine-cocoa-woes.html">
      Improve this page @ 417ff2d
    </a></p>

</div>
        </div>
    </body>
</html>
