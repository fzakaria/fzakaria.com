<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Unit test in Play! Framework with Slick | Farid Zakaria’s Blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Unit test in Play! Framework with Slick" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Testing The play framework includes some pretty good integration/documentation on how to perform testing however most of it relies on requiring a Play! application to be created (i.e. FakeApplication) and the fact that they share the same database. The second point was the more troublesome one, since in ScalaTest the tests are run in parallel. The following is what I have done to get around these problems. trait DatabaseInitializationPerTest extends PlaySpec with BeforeAndAfter { //create a unique database name, which is the class that implements this trat val dbName = this.toString.toLowerCase()" />
<meta property="og:description" content="Testing The play framework includes some pretty good integration/documentation on how to perform testing however most of it relies on requiring a Play! application to be created (i.e. FakeApplication) and the fact that they share the same database. The second point was the more troublesome one, since in ScalaTest the tests are run in parallel. The following is what I have done to get around these problems. trait DatabaseInitializationPerTest extends PlaySpec with BeforeAndAfter { //create a unique database name, which is the class that implements this trat val dbName = this.toString.toLowerCase()" />
<link rel="canonical" href="https://fzakaria.com/old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html" />
<meta property="og:url" content="https://fzakaria.com/old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html" />
<meta property="og:site_name" content="Farid Zakaria’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-07-11T18:15:46-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Unit test in Play! Framework with Slick" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-07-11T18:15:46-07:00","datePublished":"2014-07-11T18:15:46-07:00","description":"Testing The play framework includes some pretty good integration/documentation on how to perform testing however most of it relies on requiring a Play! application to be created (i.e. FakeApplication) and the fact that they share the same database. The second point was the more troublesome one, since in ScalaTest the tests are run in parallel. The following is what I have done to get around these problems. trait DatabaseInitializationPerTest extends PlaySpec with BeforeAndAfter { //create a unique database name, which is the class that implements this trat val dbName = this.toString.toLowerCase()","headline":"Unit test in Play! Framework with Slick","mainEntityOfPage":{"@type":"WebPage","@id":"https://fzakaria.com/old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html"},"url":"https://fzakaria.com/old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html"}</script>
<!-- End Jekyll SEO tag -->

        <link type="application/atom+xml" rel="alternate" href="https://fzakaria.com/feed.xml" title="Farid Zakaria&apos;s Blog" />
        <link rel="stylesheet" type="text/css" href="/assets/css/base.css">
        <link rel="icon" type="image/x-icon" href="/assets/images/avatar.ico">
        <link rel="alternate" type="application/atom+xml" title="Farid Zakaria's Blog" href="/feed.xml">

        <link ref="">

        
        
        <link href="/assets/css/highlightjs-default-theme.css" rel="stylesheet" />
        

        
            <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-35360900-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-35360900-1');
</script>

        

    </head>
    <body>
        
        <script src="/assets/js/highlight.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        

        <div class="container">
            <h1 class="page-title">
    <a class="rss pull-right" href="/feed.xml"><i class="fa fa-rss"></i></a>
    Unit test in Play! Framework with Slick
</h1>

<div class="content">
    
    <p class="date">
        Published 2014-07-11
        on <a href="/">Farid Zakaria's Blog</a>
        <span class="hidden-xs">
          &mdash;
          <a href="/old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html">
            Permalink
          </a>
        </span>
    </p>
    
    <article>
      <h2> Testing </h2>
<p> The play framework includes some pretty good integration/documentation on how to perform testing however most of it relies on requiring a Play! application to be created (i.e. FakeApplication) and the fact that they share the same database. The second point was the more troublesome one, since in ScalaTest the tests are run in parallel. The following is what I have done to get around these problems.</p>
<pre class="wrap:true lang:scala decode:true " >trait DatabaseInitializationPerTest extends PlaySpec with BeforeAndAfter {
//create a unique database name, which is the class that implements this trat
val dbName = this.toString.toLowerCase()

//the postgres database is always available. Connect to it and drop the current 
//test database (i.e. classname)
// Drop and create the database
val postgres = Database.forURL(s"jdbc:postgresql://localhost/postgres", driver = "org.postgresql.Driver")
  postgres withSession {
    implicit dbServerSession =>
      {
        logger.debug(s"Creating database: $dbName")
        Q.updateNA(s"DROP DATABASE IF EXISTS $dbName; CREATE DATABASE $dbName;").execute
      }
  }

// Connect to the database
implicit lazy val database = Database.forURL(s"jdbc:postgresql://localhost/$dbName", driver = "org.postgresql.Driver");

  before {
    database withSession { implicit session =>
      logger.debug(s"Creating the database: $dbName")
      val evolution_seq = play.api.db.evolutions.Evolutions.applicationEvolutions(new java.io.File("."), this.getClass().getClassLoader(), "default")
      evolution_seq.flatMap(e => EvolutionSqlScript(e.sql_up).statements).foreach{ sql =>
        Q.updateNA(sql).execute
      }
    }
  }

  after {
    database withSession { implicit session =>
      logger.debug(s"Destroying the database: $dbName")
      val evolution_seq = play.api.db.evolutions.Evolutions.applicationEvolutions(new java.io.File("."), this.getClass().getClassLoader(), "default")
      //I believe you have to apply sql_down in the reverse order
      evolution_seq.reverse.flatMap(e => EvolutionSqlScript(e.sql_down).statements).foreach{ sql =>
        Q.updateNA(sql).execute
      }
    }
  }

  /*
   * The following class was taken from the Play framework however they listed theirs as private.
   * @href https://github.com/playframework/playframework/blob/master/framework/src/play-jdbc/src/main/scala/play/api/db/evolutions/Evolutions.scala
   */
  case class EvolutionSqlScript(sql: String) {
    def statements: Seq[String] = {
      // Regex matches on semicolons that neither precede nor follow other semicolons
      sql.split("(?&amp;lt;!;);(?!;)").map(_.trim.replace(";;", ";")).filter(_ != "")
    }
  }

}</pre>
<p> The above code makes re-use of the Evolution plugin provided by Play! The code creates Evolution objects (which contain UpSQL and DownSQL statements) and we can apply them on a before / after method before each test. </p>


<hr />
    </article>
</div>

<div class="sidebar">
    <hr class="visible-xs" />
    <img class="avatar" src="/assets/images/avatar-164.png" alt="A photo of my dog Moose" title="My dog Moose"/>
    <p>I'm a software engineer, father and wishful amateur surfer. If you've come seeking my political views; you've found the wrong <a href="https://fareedzakaria.com/">Fareed</a>.</p>
    <div class="external-links">
      <p>
        <span class="context">linkedin</span>
        <a href="https://www.linkedin.com/in/fmzakari/">fmzakari</a>
      </p>
      <p>
        <span class="context">github</span>
        <a href="https://github.com/fzakaria">fzakaria</a>
      </p>
      <p>
        <span class="context">email</span>
        <a href="mailto:farid.m.zakaria@gmail.com">farid.m.zakaria@gmail.com</a>
      </p>
      <p>
        <span class="context">pgp</span>
        <a href="/publickey.txt">D1B232E7</a>
      </p>
      <p>
        <a href="/archive">Archive</a>
      </p>
      <p>
        <a href="/old_blog/">Historic WordPress Blog</a>
      </p>
      <!--
      <p>
        Web friendly version of my <a href="/resume/index.html">resume</a>.
      </p>
    </div>
    <h3>Projects</h3>
    <p>
      <a href="/projects/">Click here</a> for some personal
      projects I've worked on.
    </p>
    <h3>Old Blog</h3>
    <p>
      <a href="/old_blog/">Click here</a> for the archive
      of my old blog posts from Wordpress.
    </p>
    -->
    
    <h3>Recent Posts</h3>
    
    <div class="post-stub">
      2025-02-02<br />
      <a href="/2025/02/02/nix-string-interpolation-of-directories-gone-awry.html">Nix: string interpolation of directories gone awry</a>
    </div>
    
    <div class="post-stub">
      2025-01-28<br />
      <a href="/2025/01/28/bazel-build-event-protocol-viewer.html">Bazel: Build Event Protocol Viewer</a>
    </div>
    
    <div class="post-stub">
      2025-01-12<br />
      <a href="/2025/01/12/bazel-knowledge-be-mindful-of-build-without-the-bytes.html">Bazel Knowledge: Be mindful of Build Without the Bytes (bwob)</a>
    </div>
    
    
    <h3>License</h3>
    <p style="font-size: 10pt">
    The content for this site is
    <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.
    The <a href="https://github.com/SirCmpwn/ddjekyll">inspiration for the theme</a> for this site is
    © Drew Devault.
    </p>
    <div class="spacer" style="margin-top: 30px;"></div>
    
    <p><a href="https://github.com/fzakaria/fzakaria.com/edit/master/_old_blog/2014-07-11-unit-test-in-play-framework-with-slick.html">
      Improve this page @ 417ff2d
    </a></p>

</div>
        </div>
    </body>
</html>
